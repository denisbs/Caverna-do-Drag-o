#include <stdio.h>
#include <stdlib.h>
#include <winsock.h>
#include <windows.h>

#define mapa_size 13

WSADATA data; //Variíveis que recebem o valor da inicialização e criação do socket.
//SOCKET winsock; //Variíveis que recebem o valor da inicialização e criação do socket.
SOCKADDR_IN sock; //Variíveis que recebem o valor da inicialização e criação do socket

typedef struct{
    int x;
    int y;

    int estado;

    int spritel;
    int spritec;

    int atacando;

    int trapX;
    int trapY;
    int Trapativa;
    int spriteT;
    int vida;

    int inicia;

    int chave;
}dados;


typedef struct {
        int x[8];
        int y[8];
        int ativa[8];

}pontoNas;

dados personagens[4];
pontoNas inicios;

HANDLE MeuMutex;

int cont = 0;
int iniciar = 0;
int clientes[4];
int posicaoPersonagem[4][4];
int saidaMapa;

int mapa[67][71] = {
                    41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,40,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,40,
                    41, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2,42, 2, 2, 2, 2, 2,42, 2, 2, 2, 2, 2,40, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,40,
                    41, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2,42, 2, 2, 2, 2, 2,42, 2, 2, 2, 2, 2,40, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,40,
                    41, 2, 2,42, 2, 2, 2,42, 2, 2,42, 2, 2,42, 2, 2,42, 2, 2,42, 2, 2,42, 2, 2,40, 1, 1,37, 1, 1,37, 1, 1,40, 1, 1,35, 1, 1,35, 1, 1,38,38,38,38,38,38,38,38,38,38,37,37,37,37,37,37,37,37,38, 1, 1,37, 1, 1,37, 1, 1,40,
                    41, 2, 2, 2, 2, 2, 2, 2, 2, 2,42, 2, 2,42, 2, 2,42, 2, 2,42, 2, 2,42, 2, 2,40, 1, 1, 1, 1, 1, 1, 1, 1,40, 1, 1, 1, 1, 1, 1, 1, 1,38, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,37, 1, 1,38, 1, 1, 1, 1, 1, 1, 1, 1,40,
                    41, 2, 2, 2, 2, 2, 2, 2, 2, 2,42, 2, 2, 2, 2, 2,42, 2, 2, 2, 2, 2,42, 2, 2,40, 1, 1, 1, 1, 1, 1, 1, 1,40, 1, 1, 1, 1, 1, 1, 1, 1,38, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,37, 1, 1,38, 1, 1, 1, 1, 1, 1, 1, 1,40,
                    41, 2, 2,42, 2, 2, 2,42, 2, 2,42, 2, 2, 2, 2, 2,42, 2, 2, 2, 2, 2,42, 2, 2,40, 1, 1,37, 1, 1,37, 1, 1,40,37,37,37,37,37,37,37,37,38, 1, 1,38,38,38,38,38,38,38,38,38,37, 1, 1,37, 1, 1,38, 1, 1,37, 1, 1,37, 1, 1,40,
                    41, 2, 2, 2, 2, 2, 2, 2, 2,42,42,42,42,42,42,42,42,42,42, 2, 2,42,42, 2, 2, 1, 1, 1, 1, 1, 1, 1, 1, 1,40, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,37, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,40,
                    41, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2,42, 2, 2,42,42, 2, 2, 1, 1, 1, 1, 1, 1, 1, 1, 1,40, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,37, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,40,
                    41, 2, 2,42, 2, 2, 2,42, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2,42, 2, 2,42,42,42,42,38,39,38,39,38,39,38,39,38,40, 1, 1,38,39,38,39,38,39,38,39,38,38, 1, 1,38,38,38,38,38,38,37,38,38,38,38,38,38,38,38,38,38,38,38,38,38,40,
                    41, 2, 2, 2, 2, 2, 2, 2, 2, 2,42, 2, 2, 2,42, 2, 2, 2,42, 2, 2, 2, 2, 9, 9, 9, 9, 9, 9, 9, 9, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 3, 3, 3,38, 1, 1,38, 1, 1, 1, 1, 1,37, 1, 1, 1, 1, 1,37, 1, 1, 1, 8, 8, 8, 8, 8,41,
                    41, 2, 2, 2, 2,41, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2,42, 2, 2, 2, 2, 9, 9, 9, 9, 9, 9, 9, 9, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 3, 3, 3,38, 1, 1,38, 1, 1, 1, 1, 1,37, 1, 1, 1, 1, 1,37, 1, 1, 1, 8, 8, 8, 8, 8,41,
                    41, 2, 2, 2, 2,41,41,41,41, 2, 2, 2, 2, 2, 2, 2, 2, 2,38,38,39,38,39,38,39,38,39,38,39,38,39,38,40, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2,41, 3, 3,38, 1, 1,38, 1, 1,37, 1, 1,37, 1, 1,37, 1, 1,37, 1, 1,41, 8, 8, 8, 8, 8,41,
                    41, 2, 2, 2, 2, 2, 2, 2,41, 2, 2,42, 2,42, 2, 2, 2, 2, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,40, 2, 2, 2,42,42,42,42,42,42,42,41, 3, 3,38, 1, 1, 1, 1, 1,37, 1, 1, 1, 1, 1,37, 1, 1, 1, 1, 1,41, 8, 8, 8, 8, 8,41,
                    41, 2, 2, 2, 2, 2, 2, 2,41, 2, 2, 2, 2, 2, 2, 2, 2, 2, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,40, 2, 2, 2, 2,42,42,42,42,42,42,41, 3, 3,38, 1, 1, 1, 1, 1,37, 1, 1, 1, 1, 1,37, 1, 1, 1, 1, 1,41, 8, 8,41,41,41,41,
                    41, 2, 2,42, 2, 2, 2, 2,41, 2, 2, 2, 2, 2, 2, 2, 2, 2, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,40, 2, 2, 2, 2, 2,42,42,42,42,42,41, 3, 3,38,39,38,39,38,39,38,39,38,39,38,39,38,39,38,39,38,39,41, 8, 8, 8,55, 8,41,
                    40,38,39,38, 1, 1,38,38,40,38,39,38,39,38,39,38,39,38,40,38,38,38,38,38,38,38,38,38,38,38, 1, 1,40,42, 2, 2, 2, 2, 2,42,42,42,42,41, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3,41, 8, 8, 8, 8, 8,41,
                    40, 1, 1, 1, 1, 1,35, 1,40, 1, 1, 1, 1, 1, 1, 1, 1, 1,40, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,40,42,42, 2, 2, 2, 2, 2,42,42,42,41, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3,41, 8, 8, 8, 8, 8,41,
                    40, 1, 1, 1, 1,35, 1, 1,40, 1, 1, 1, 1, 1, 1, 1, 1, 1,40, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,40,42,42,42, 2, 2, 2, 2, 2,42,42,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41, 3, 3, 3, 3, 3, 3,41, 8, 8,41,41,41,41,
                    40, 1, 1, 1, 1, 1, 1, 1,40, 1, 1,37, 1, 1, 1,35, 1, 1,40, 1, 1,38,38,38,40,38,38,38,38,38, 1, 1,40,42,42,42,42, 2, 2, 2, 2, 2,42,41, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7,41, 3, 3, 3, 3, 3, 3,41, 8, 8, 8,55, 8,41,
                    40, 1, 1, 1, 1, 1, 1, 1,40, 1, 1, 1, 1, 1, 1, 1, 1, 1,40, 1, 1, 1, 1, 1,40, 1, 1, 1, 1, 1, 1, 1,40,42,42,42,42,42, 2, 2, 2, 2, 2,41, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7,41, 3, 3, 3, 3, 3, 3,41, 8, 8, 8, 8, 8,41,
                    40, 1, 1,37, 1, 1, 1, 1,40, 1, 1, 1, 1,37, 1, 1, 1, 1,40, 1, 1, 1, 1, 1,40, 1, 1, 1, 1, 1, 1, 1,40,40,40,40,40,40,40,41, 7, 7, 7,37, 7, 7, 7, 7, 7, 7, 7,37,37,37,37, 7, 7,41,41,41,41,41, 3, 3,41, 8, 8, 8, 8, 8,41,
                    40, 1, 1, 1, 1, 1, 1, 1,40, 1, 1, 1, 1, 1, 1, 1, 1, 1,40,38,38,38, 1, 1,40, 1, 1,40,40,40, 1, 1, 1,40, 1, 1, 1, 1, 1,41, 7, 7, 7,37, 7, 7, 7, 7, 7, 7, 7,49, 7, 7,49, 7, 7, 7, 7, 7, 7,41, 3, 3,41, 8, 8,41,41,41,41,
                    40, 1, 1, 1, 1,37, 1, 1,40, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,40, 1, 1, 1,40, 1, 1, 1, 1,40, 1, 1, 1, 1, 1,41, 7, 7, 7,37, 7, 7, 7, 7, 7, 7, 7,49, 7, 7,49, 7, 7, 7, 7, 7, 7,41, 3, 3,41, 8, 8, 8,55, 8,41,
                    40, 1, 1, 1, 1, 1, 1, 1,40, 1, 1,35, 1, 1,37, 1, 1, 1, 1, 1, 1, 1, 1, 1,40, 1, 1, 1,40, 1, 1, 1, 1,40, 1, 1,40, 1, 1,41, 7, 7, 7,37, 7, 7,49, 7, 7, 7, 7,49, 7, 7,49, 7, 7, 7, 7, 7, 7,41, 3, 3,41, 8, 8, 8, 8, 8,41,
                    40, 1, 1,36, 1, 1, 1, 1,40, 1, 1, 1, 1, 1, 1, 1, 1,40,38,38,38,38,38,38,40, 1, 1, 1,40, 1, 1, 1, 1,40, 1, 1,40, 1, 1,41, 7, 7, 7,37, 7, 7, 7, 7, 7, 7, 7,49, 7, 7,49, 7, 7, 7, 7, 7, 7,41, 3, 3,41, 8, 8, 8, 8, 8,41,
                    40, 1,36, 1, 1, 1, 1, 1,40, 1, 1, 1, 1, 1, 1, 1, 1,40, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,40, 1, 1, 1, 1,40, 1, 1,40, 1, 1,41, 7, 7, 7,37, 7, 7, 7, 7, 7, 7, 7,49, 7, 7,49, 7, 7, 7, 7, 7, 7,41, 3, 3,41, 8, 8,41,41,41,41,
                    40,38,38, 1, 1,38,39,38,40,38,39,38,38,38,38,38,38,40, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,40, 1, 1, 1, 1,40, 1, 1,40, 1, 1,41, 7, 7, 7,37,49,49,49,49,49,49,49,49, 7, 7,49,49,49,49,49, 7, 7,41, 3, 3,41, 8, 8, 8,55, 8,41,
                    41, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,40, 1, 1,40,40,40, 1, 1,40, 1, 1,41, 7, 7, 7,37, 7, 7, 7, 7, 7, 7, 7,36, 7, 7, 7, 7, 7, 7,37, 7, 7,41, 3, 3,41, 8, 8, 8, 8, 8,41,
                    41, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,40, 1, 1, 1, 1, 1, 1, 1,40, 1, 1,41, 7, 7, 7,37, 7, 7, 7, 7, 7, 7, 7,35, 7, 7, 7, 7, 7, 7,37, 7, 7,41, 3, 3,41, 8, 8, 8, 8, 8,41,
                    41, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 1, 1, 1, 1, 1, 1, 1, 1, 1,44,44,44,44, 1, 1, 1,40, 1, 1, 1, 1, 1, 1, 1,40, 1, 1,41, 7, 7,50,50, 7, 7,50,50, 7, 7,50,50, 7, 7,50,50, 7, 7,37, 7, 7,41, 3, 3,41, 8, 8,41,41,41,41,
                    41, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3,41,44,44,44,44,44,44,44,44,44, 4, 4, 4, 4,44,44,44,44,44,44,44,44,44,44,40,40, 1, 1,41, 7, 7,52,51, 7, 7,52,51, 7, 7,52,51, 7, 7,52,51,36,36,37, 7, 7,41, 3, 3,41, 8, 8, 8,55, 8,41,
                    41, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3,41, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 1, 1,41, 7, 7,36, 7, 7, 7,36, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7,37, 7, 7,41, 3, 3,41, 8, 8, 8, 8, 8,41,
                    41, 3,12,26,11,45,46,11,27,13, 3,41, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4,44,44, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 1, 1,41, 7, 7,35, 7, 7, 7,35, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7,37, 7, 7,41, 3, 3,41, 8, 8, 8, 8, 8,41,
                    41, 3,30,16, 2, 2, 2, 2,17,31, 3,41,44,44, 4, 4,44,44,44,44,44,44, 4, 4,44,44,44,44,44,44,44,44,44,44,44,41,41, 1, 1,41, 7, 7,50,50, 7, 7,50,50,35,35,50,50, 7, 7,50,50, 7, 7,37, 7, 7,41, 3, 3,41, 8, 8, 8, 8, 8,41,
                    41, 3,10, 2,16, 2, 2,17, 2,10, 3,41, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4,41, 1, 1, 1,41, 7, 7,52,51, 7, 7,52,51, 7, 7,52,51, 7, 7,52,51, 7, 7,37, 7, 7,41, 3, 3,41, 8, 8, 8, 8, 8,41,
                    41, 3,10, 2, 2,18,19, 2, 2,10, 3,41, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4,41, 1, 1, 1,41, 7, 7, 7,36, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7,35, 7, 7,37, 7, 7,41, 3, 3,41,41,41,41,41,41,41,
                    41, 3,10, 2, 2, 2, 2, 2, 2,10, 3,41,44,44,44,44,44,44,44, 4,44,44,44,44,44,44,44,44,44,44,44,44,44, 4, 4,41, 1, 1, 1,41, 7, 7, 7,35, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7,35, 7, 7,37, 7, 7,37, 3, 3, 3, 3, 3, 3, 3, 3,41,
                    41, 3,10, 2, 2, 2, 2, 2, 2,10, 3,41, 4, 4, 4, 4, 4, 4, 4,44, 4, 4, 4, 4, 4, 4,44, 4, 4, 4, 4, 4,44, 4, 4,41, 1, 1, 1,41, 7, 7,50,50, 7, 7,50,50, 7, 7,50,50,35,35,50,50, 7, 7,37, 7, 7,37, 3, 3, 3, 3, 3, 3, 3, 3,41,
                    41, 3,10, 2, 2,22,23, 2, 2,10, 3,41, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4,44, 4, 4, 4, 4, 4,44, 4, 4,41, 1, 1, 1,41, 7, 7,52,51,35,35,52,51, 7, 7,52,51, 7, 7,52,51, 7, 7,37, 7, 7,41,41,41,41, 3, 3,56, 3, 3,41,
                    41, 3,10, 2, 2,24,25, 2, 2,10, 3,41, 4, 4, 4, 4,44, 4, 4, 4, 4, 4,44, 4, 4, 4,44, 4, 4,44, 4, 4,44, 4, 4,41, 1, 1, 1,41, 7, 7,36, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7,35, 7, 7, 7, 7, 7, 7,41, 7, 7,41, 3, 3,56, 3, 3,41,
                    41, 3,10, 2, 2, 2, 2, 2, 2,10, 3,41, 4, 4, 4, 4,44, 4, 4, 4, 4, 4,44, 4, 4, 4,44, 4, 4,44, 4, 4,44, 4, 4,41, 1, 1, 1,41, 7, 7,35, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7,35, 7, 7, 7, 7, 7, 7,41, 7, 7,41, 3, 3,56, 3, 3,41,
                    41, 3,10, 2, 2, 2, 2, 2, 2,10, 3,41, 4, 4, 4, 4,44,41,41,41,41,41,41,41, 4, 4,44, 4, 4,44, 4, 4,44, 4, 4,41, 1, 1, 1,41, 7, 7,50,50, 7, 7,50,50,35,35,50,50, 7, 7,50,50,35,35,35,35,35,41, 7, 7,41, 3, 3,56, 3, 3,41,
                    41, 3,10, 2, 2,20,21, 2, 2,10, 3,41, 4, 4, 4, 4, 4,41,53,53,53,53,53,41, 4, 4,44, 4, 4,44, 4, 4,44, 4, 4,41, 1, 1, 1,41, 7, 7,52,51, 7, 7,52,51, 7, 7,52,51, 7, 7,52,51, 7, 7,36, 7, 7,41, 7, 7,41, 3, 3,56, 3, 3,41,
                    41, 3,10, 2,17, 2, 2,16, 2,10, 3,41, 4, 4,44, 4, 4,41,34,34,34,34,34,41, 4, 4,44, 4, 4,44, 4, 4, 4, 4, 4,41, 1, 1, 1,41, 7, 7, 7, 7, 7, 7, 7,35, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7,35, 7, 7,41, 7, 7,41, 3, 3,56, 3, 3,41,
                    41, 3,33,17, 2, 2, 2, 2,16,32, 3,41, 4, 4, 4, 4, 4,41,34,34,34,34,34,41, 4, 4, 4, 4, 4,44, 4, 4, 4, 4, 4,41, 1, 1, 1,41, 7, 7, 7, 7, 7, 7, 7,35, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7,41, 3, 3,56, 3, 3,41,
                    41, 3,15,29,11,47,48,11,28,14, 3,41, 4, 4, 4, 4, 4,41,34,34,34,34,34,41, 4, 4, 4, 4, 4,44, 4, 4, 4, 4, 4,41, 1, 1, 1,41, 7, 7,50,50, 7, 7,50,50, 7, 7,50,50, 7, 7,50,50, 7, 7, 7, 7, 7, 7, 7, 7,41, 3, 3,56, 3, 3,41,
                    41, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3,41,41,41,41,41,41,41,34,34,34,34,34,41,41,41,41,41,41,41,41,41,41,41,41,41, 1, 1, 1,41, 7, 7,52,51,36,36,52,51,35,35,52,51,36,36,52,51,35,35,41,41,41,41,41,41,41, 3, 3,56, 3, 3,41,
                    41, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3,41, 5,34,34,34,34,34,34,34,34,34, 5,41, 6, 6, 6, 6, 6, 6, 6, 6, 6, 1, 1, 1, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 3, 3,56, 3, 3,41,
                    41, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3,41, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5,41, 6, 6, 6, 6, 6, 6, 6, 6, 6, 1, 1, 1, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 3, 3,56, 3, 3,41,
                    41,57,57,57,57, 6, 6,57,57,57,57,43,43,43,41, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5,41, 6, 6, 6, 6, 6, 6,57, 6, 6,57,57,57,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41, 3, 3,56, 3, 3,41,
                    41,57, 6, 6, 6, 6, 6, 6, 6, 6,57,43,41,41,41, 5, 5,36,36,36,36,36,36,36,36,36,41,41,41,41,41, 6, 6,43, 6, 6,43,43, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6,57,57, 6, 6, 6,57, 6, 6,41,
                    41,57, 6, 6, 6, 6, 6, 6, 6, 6,57,43,41, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5,41, 6, 6,43, 6, 6,43,43,43, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6,57,57, 6, 6, 6,57, 6, 6,41,
                    41,57, 6, 6,43,54,54,43, 6, 6,57,41,41, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5,41, 6, 6,43, 6, 6,43,43,43,43, 6, 6, 6,43,43,43,43,43, 6, 6,43,43,43,43,43,43,43,43,43,43, 6, 6,57,57, 6, 6,57,57, 6, 6,41,
                    41,57, 6, 6,43,54,54,43, 6, 6,57,41, 5,36,36,36,36,36,36,36,36,36,36,36,36,36,36,36, 5, 5,41, 6, 6,43, 6, 6,43,43,43,43,43, 6, 6, 6,43,43,43,43, 6, 6,43,43,43,43, 6, 6, 6,43,43,43, 6, 6,57,57, 6, 6,57,57, 6, 6,41,
                    41,57, 6, 6,43,43,43,43, 6, 6,57,41, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5,41, 6, 6,43, 6, 6,43,43,43,43,43,43, 6, 6, 6,43,43,43, 6, 6,43,43,43, 6, 6, 6,43,43,43,43, 6, 6,57,57, 6, 6,57,57, 6, 6,41,
                    41,57, 6, 6, 6, 6, 6, 6, 6, 6,57,41, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5,41, 6, 6,43, 6, 6,43,43,43,43,43,43,43, 6, 6, 6,43,43, 6, 6,43,43, 6, 6, 6,43,43,43,43,43, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6,41,
                    41,57, 6, 6, 6, 6, 6, 6, 6, 6,57,41, 5, 5,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41, 6, 6,43, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6,43, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6,43, 6, 6,57,57, 6, 6, 6, 6, 6, 6,41,
                    41,57,57,57,57, 6, 6,57,57,57,57,41, 5, 5,41,57, 6, 6, 6, 6, 6, 6, 6, 6, 6,57, 6, 6, 6, 6, 6, 6, 6,43, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6,43, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6,43, 6, 6,57,57, 6, 6,57,57, 6, 6,41,
                    41,43, 6, 6, 6, 6, 6, 6, 6, 6,57,41, 5, 5,41,57, 6, 6, 6, 6, 6, 6, 6, 6, 6,57, 6, 6, 6, 6, 6, 6, 6,43, 6, 6,43,43,43,43,43,43,43, 6, 6, 6,43,43,43,43,43,43, 6, 6, 6,43,43,43,43,43, 6, 6,57,57, 6, 6,57,57, 6, 6,41,
                    41,43, 6, 6, 6, 6, 6, 6, 6, 6,43, 6, 6, 6, 6, 6, 6, 6, 6,43,43,43,57, 6, 6,57, 6, 6,57,57,57, 6, 6,43, 6, 6, 6, 6, 6,43,43,43, 6, 6, 6,43,43,43,43,43,43,43,43, 6, 6, 6,43,43,43,43, 6, 6, 6, 6, 6, 6,57,57, 6, 6,41,
                    41,43,43,43,43,43,43,43, 6, 6,43, 6, 6, 6, 6, 6, 6, 6, 6,43, 6, 6, 6, 6, 6,57, 6, 6, 6, 6,57, 6, 6,43, 6, 6, 6, 6, 6,43,43, 6, 6, 6,43,43, 6, 6, 6, 6,43,43,43,43, 6, 6, 6,43,43,43, 6, 6, 6, 6, 6, 6,57,57, 6, 6,41,
                    41, 6, 6, 6, 6, 6, 6, 6, 6, 6,43,43,43,43,43,43,43,43,43,43, 6, 6, 6, 6, 6,57, 6, 6, 6, 6,57, 6, 6, 6, 6, 6,43, 6, 6,43, 6, 6, 6,43,43, 6, 6, 6, 6, 6,43,43,43,43,43, 6, 6, 6,43,43, 6, 6, 6, 6, 6, 6,57,57, 6, 6,41,
                    41, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6,57, 6, 6,57,57,57, 6, 6,57, 6, 6, 6, 6, 6,43, 6, 6, 6, 6, 6,43,43, 6, 6, 6,54, 6, 6,43,43,43,43,43,43, 6, 6, 6,43,43,43,43,43,43,43,43,42, 6, 6,41,
                    41, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6,57, 6, 6, 6, 6, 6,43, 6, 6, 6, 6, 6,43, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6,43,43,43,43,43,43,43,42, 6, 6,41,
                    41, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6,57, 6, 6, 6, 6, 6,43,43,43,43,43,43,43, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6,43,43,43,43,43,43,42, 6, 6,41,
                    41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41
                    }; // mapa base

void Servidor(void* arg){
    int sockEntrada = (*(int *) arg);
    int EstadoAtual;
    dados armazena;
    /*if (sockEntrada < 0){
        sockEntrada = sockEntrada + 1;
    }*/
    printf("%d\n", sockEntrada);
    printf("%d\n", clientes[sockEntrada]);
    printf("---------------------------------------\n");
    send(clientes[sockEntrada], &sockEntrada, sizeof(sockEntrada),0);
    send(clientes[sockEntrada], &mapa, sizeof(mapa),0);
    //send(clientes[sockEntrada], &saidaMapa, sizeof(saidaMapa),0);
    sortearNas(sockEntrada);
    send(clientes[sockEntrada], (void*)&personagens, sizeof(personagens),0);
    while(1){
        //printf("oi oio io ioi o io i");EstadoAtual = WaitForSingleObject(MeuMutex, INFINITE);

        if (cont > 0 ){
            recv(clientes[sockEntrada], (void*)&armazena, sizeof(armazena),0);
            WaitForSingleObject(MeuMutex, INFINITE);
            if (iniciar < 4){
                iniciar++;
                //printf("%d\n",iniciar);
            }else{
                if (armazena.atacando < 5){
                    personagens[armazena.atacando].estado = 7;
                }
                personagens[sockEntrada] = armazena;
            }
            ReleaseMutex(MeuMutex);


            //printf("%d\n", personagens[sockEntrada].x);
            //printf("%d\n", personagens[sockEntrada].y);
            //send(clientes[sockEntrada], (void*)&personagens, sizeof(personagens),0);
        }
            //Sleep(2000);
        /*printf("Posicao x %d\n",posicaoPersonagem[0][sockEntrada]);
        printf("Posicao y %d\n",posicaoPersonagem[1][sockEntrada]);*/
    }
}

void enviaClientes(){
    int k;
    while(1){
        Sleep(20);
        if(iniciar != 4){
            for(k = 0; k < 4; k++){
                if (k < cont){
                    send(clientes[k], (void*)&personagens, sizeof(personagens),0);
                }
            }
        }else{
            for(k = 0; k < 4; k++){
                personagens[k].inicia = 1;
                //printf("adcionei\n");
            }
            iniciar++;
        }
    }
}

void sortearNas(int n){


   int p, C;
   personagens[n].vida = 3;
   C = 1;
   srand((unsigned)time(NULL));
   while(C == 1){

        p = rand()%8;
        if(inicios.ativa[p] != 1 ){
            personagens[n].x = inicios.x[p]*50;
            personagens[n].y = inicios.y[p]*50;
            personagens[n].estado = 0;
            personagens[n].atacando = 5;
            printf("%d,\n%d\n", inicios.x[p]*50,inicios.y[p]*50);
            //send(clientes[n], (void*)&personagens[n], sizeof(personagens[n]),0);

            inicios.ativa[p] = 1;
            C=0;
        }
   }

}

void sorteaA(){
    int a, C;
    int nL, nC;
    C = 0;
    srand((unsigned)time(NULL));
    for (a = 0; a < 100; a++ ){
        nL = rand()%mapa_size;
        nC = rand()%mapa_size;
        while (C == 0){
            if(mapa[nC][nL] <= 34){
                mapa[nC][nL] = mapa[nC][nL] + 100;
                C = 1;
                printf(" trap em: %d - %d\n", nL, nC);
            }else{
                nL = rand()%mapa_size;
                nC = rand()%mapa_size;
            }
        }
        C = 0;

    }
}

void setI(){

    inicios.x[0] = 1;
    inicios.y[0] = 1;
    mapa[1][1] = 60;

    inicios.x[1] = 33;
    inicios.y[1] = 1;
    mapa[33][1] = 60;

    inicios.x[2] = 65;
    inicios.y[2] = 1;
    mapa[65][1] = 60;

    inicios.x[3] = 65;
    inicios.y[3] = 35;
    mapa[65][35] = 60;

    inicios.x[4] = 65;
    inicios.y[4] = 65;
    mapa[65][69] = 60;

    inicios.x[5] = 1;
    inicios.y[5] = 65;
    mapa[1][68] = 60;

    inicios.x[6] = 10;
    inicios.y[6] = 5;
    mapa[10][5] = 60;

    inicios.x[7] = 1;
    inicios.y[7] = 35;
    mapa[1][35] = 60;

}

int criaServidor(){
    int winsock;
    struct sockaddr_in serverAddr; /*Declaracao da estrutura*/
    if(WSAStartup(MAKEWORD(2,0),&data)==SOCKET_ERROR)
    {
        printf("Erro ao inicializar o winsock");
        //return 0;
    }
    if((winsock = socket(AF_INET,SOCK_STREAM,0))==SOCKET_ERROR)
    {
        printf("Erro ao criar socket");
        //return 0;
    }

    memset(&serverAddr, 0, sizeof (serverAddr));/*Zera a estrutura*/
    sock.sin_family=AF_INET; //tipo de familia
    sock.sin_port=htons(1235); //Numero da porta de rede

    if(bind(winsock,(SOCKADDR*)&sock,sizeof(sock))==SOCKET_ERROR)
    {
        printf("Erro colocar utilizar a funcao BIND");
        //return 0;
    }

    if (listen(winsock,5) < 0)
    {
        printf("Erro no Socket\n");
        exit(1);
    }

    /*while((winsock = accept(winsock,0,0))==SOCKET_ERROR)
    {
        Sleep(1);
    }*/
    return winsock;
}

int main(){
    HANDLE th[5];
    DWORD Ith;

    MeuMutex = CreateMutex(NULL, FALSE, NULL);
    if(MeuMutex == NULL){
        printf("Erro na funcao CreateMutex:%d\n",GetLastError());
        return 0;
    }

    setI();
    sorteaA();
    int i = 0;
    struct sockaddr_in clienteAddr;
    int winsock = criaServidor();


    while(1)
    {
        /*tamanho da estrutura*/
        unsigned int clntLen;
        clntLen = sizeof (clienteAddr);

        /*Fica no aguardo da conexao do cliente*/
        clientes[cont] = accept(winsock, (struct sockaddr *) & clienteAddr, &clntLen);
        if (clientes[cont] < 0)
        {
            Sleep(1);
      		/*printf("Erro no Socket\n");
      		exit(1);*/
        }else{

            /*Inicializa a thread*/
            //th[i] = CreateThread(th[i],0,Servidor,0,0,&clientes[cont]);
            printf("%d\n", clientes[cont]);
            printf("%d\n",cont);
            th[cont] = CreateThread(NULL,0,Servidor,&cont,0,&Ith);
            if (th[cont] == NULL)
            {
                printf("Erro na Thread\n",GetLastError());
                return 0;
            }
            Sleep(1000);
            cont++;
            if (cont == 1){
                //Sleep(1000);
                th[4] = CreateThread(NULL,0,enviaClientes,0,0,NULL) == 0;
            }

            //cont++;
            i++;
        }
    }
    printf("Hello world!\n");
    return 0;
}
